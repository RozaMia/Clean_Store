{% extends "base.html" %}
{% load static %}

{% block title %}{{ subcategory.title }} ‚Äî {{ category.title }} ‚Äî Clean Store{% endblock %}

{% block content %}
<div class="products-page">
    <div class="container">
        <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
        <nav class="breadcrumb">
            <a href="{% url 'home' %}" class="breadcrumb-link">–ì–ª–∞–≤–Ω–∞—è</a>
            <span class="breadcrumb-separator">‚Üí</span>
            <a href="{% url 'appProducts:category_list' %}" class="breadcrumb-link">–ö–∞—Ç–∞–ª–æ–≥</a>
            <span class="breadcrumb-separator">‚Üí</span>
            <a href="{% url 'appProducts:subcategory_list' category.slug %}" class="breadcrumb-link">{{ category.title }}</a>
            <span class="breadcrumb-separator">‚Üí</span>
            <span class="breadcrumb-current">{{ subcategory.title }}</span>
        </nav>

        <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ -->
        <div class="category-header">
            <div class="category-header-content">
                <h1 class="category-title">{{ subcategory.title }}</h1>
                {% if subcategory.description %}
                    <p class="category-description">{{ subcategory.description }}</p>
                {% endif %}
                <div class="category-meta">
                    <span class="subcategory-count">{{ page_obj.paginator.count }} —Ç–æ–≤–∞—Ä–æ–≤</span>
                </div>
            </div>
            {% if subcategory.image %}
                <div class="category-image">
                    <img src="{{ subcategory.image.url }}" alt="{{ subcategory.title }}">
                </div>
            {% else %}
                <div class="category-image-placeholder">
                    {% if '–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä' in subcategory.title|lower %}üóÇÔ∏è
                    {% elif '—Å–∏–∑' in subcategory.title|lower %}ü¶∫
                    {% elif '—Ö–∏–º–∏—è' in subcategory.title|lower %}üß™
                    {% elif '–∏–Ω–≤–µ–Ω—Ç–∞—Ä—å' in subcategory.title|lower %}üßπ
                    {% elif '—Å—Ä–µ–¥—Å—Ç–≤–∞' in subcategory.title|lower %}üß¥
                    {% elif '—É—Ä–Ω–∞' in subcategory.title|lower %}üóëÔ∏è
                    {% elif '—É–±–æ—Ä–∫–∞' in subcategory.title|lower %}üßΩ
                    {% else %}üìã{% endif %}
                </div>
            {% endif %}
        </div>

        <!-- –§–∏–ª—å—Ç—Ä—ã -->
        <section class="filters-section">
            <h2 class="section-title">–§–∏–ª—å—Ç—Ä—ã</h2>
            <div class="filters-grid">
                <a href="." class="filter-btn {% if not request.GET.tag %}active{% endif %}">
                    <span class="filter-icon">üîç</span>
                    –í—Å–µ —Ç–æ–≤–∞—Ä—ã
                </a>
                <a href="?tag=new" class="filter-btn {% if request.GET.tag == 'new' %}active{% endif %}">
                    <span class="filter-icon">‚ú®</span>
                    –ù–æ–≤–∏–Ω–∫–∏
                </a>
                <a href="?tag=hit" class="filter-btn {% if request.GET.tag == 'hit' %}active{% endif %}">
                    <span class="filter-icon">üî•</span>
                    –•–∏—Ç—ã –ø—Ä–æ–¥–∞–∂
                </a>
                <a href="?tag=sale" class="filter-btn {% if request.GET.tag == 'sale' %}active{% endif %}">
                    <span class="filter-icon">üí∞</span>
                    –†–∞—Å–ø—Ä–æ–¥–∞–∂–∞
                </a>
            </div>
        </section>

        <!-- –¢–æ–≤–∞—Ä—ã -->
        <section class="products-section">
            <div class="section-header">
                <h2 class="section-title">–¢–æ–≤–∞—Ä—ã</h2>
                <span class="products-count">–ù–∞–π–¥–µ–Ω–æ: {{ page_obj.paginator.count }} —Ç–æ–≤–∞—Ä–æ–≤</span>
            </div>
            
            <div class="products-grid">
                {% for product in page_obj %}
                    <div class="product-card catalog-card">
                        <a href="{% url 'appProducts:product_detail' category.slug subcategory.slug product.slug %}" class="category-link-full">
                            <div class="category-image-container">
                                {% if product.main_image %}
                                    <img src="{{ product.main_image.url }}" alt="{{ product.name }}" class="category-image">
                                {% else %}
                                    <div class="category-placeholder">
                                        <span class="placeholder-emoji">üßΩ</span>
                                        <div class="placeholder-text">
                                            –ù–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                                        </div>
                                    </div>
                                {% endif %}
                                
                                <!-- –ë–µ–π–¥–∂–∏ -->
                                <div class="product-badges">
                                    {% if product.is_new %}
                                        <span class="product-badge new">–ù–æ–≤–∏–Ω–∫–∞</span>
                                    {% endif %}
                                    {% if product.is_hit %}
                                        <span class="product-badge hit">–•–∏—Ç</span>
                                    {% endif %}
                                    {% if product.is_sale %}
                                        <span class="product-badge sale">–°–∫–∏–¥–∫–∞</span>
                                    {% endif %}
                                </div>
                            </div>
                            
                            <div class="category-content">
                                <h3 class="category-title">{{ product.name }}</h3>
                                {% if product.description %}
                                    <p class="category-description">{{ product.description|truncatewords:8 }}</p>
                                {% endif %}
                                <div class="category-meta">
                                    <span class="product-price">
                                        {{ product.price|floatformat:0 }} ‚ÇΩ
                                    </span>
                                    <div class="category-action">
                                        <span class="category-btn">
                                            –ü–æ–¥—Ä–æ–±–Ω–µ–µ ‚Üí
                                        </span>
                                    </div>
                                </div>
                            </div>
                        </a>
                    </div>
                {% empty %}
                    <div class="empty-state">
                        <div class="empty-icon">üì¶</div>
                        <h3>–¢–æ–≤–∞—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</h3>
                        <p>–í –¥–∞–Ω–Ω–æ–π –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –ø–æ–∫–∞ –Ω–µ—Ç —Ç–æ–≤–∞—Ä–æ–≤</p>
                        <a href="{% url 'appProducts:subcategory_list' category.slug %}" class="btn btn-primary">
                            –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                        </a>
                    </div>
                {% endfor %}
            </div>
        </section>

        <!-- –ü–∞–≥–∏–Ω–∞—Ü–∏—è -->
        {% if page_obj.has_other_pages %}
        <section class="pagination-section">
            <div class="pagination">
                {% if page_obj.has_previous %}
                    <a href="?page=1{% if request.GET.tag %}&tag={{ request.GET.tag }}{% endif %}" class="pagination-btn">
                        ‚ü®‚ü® –ü–µ—Ä–≤–∞—è
                    </a>
                    <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.tag %}&tag={{ request.GET.tag }}{% endif %}" class="pagination-btn">
                        ‚ü® –ü—Ä–µ–¥—ã–¥—É—â–∞—è
                    </a>
                {% endif %}

                <span class="pagination-current">
                    –°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ page_obj.number }} –∏–∑ {{ page_obj.paginator.num_pages }}
                </span>

                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}{% if request.GET.tag %}&tag={{ request.GET.tag }}{% endif %}" class="pagination-btn">
                        –°–ª–µ–¥—É—é—â–∞—è ‚ü©
                    </a>
                    <a href="?page={{ page_obj.paginator.num_pages }}{% if request.GET.tag %}&tag={{ request.GET.tag }}{% endif %}" class="pagination-btn">
                        –ü–æ—Å–ª–µ–¥–Ω—è—è ‚ü©‚ü©
                    </a>
                {% endif %}
            </div>
        </section>
        {% endif %}
    </div>
</div>
{% endblock %}